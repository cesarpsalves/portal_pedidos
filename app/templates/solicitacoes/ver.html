{% extends 'base.html' %}
{% block content %}

<h2>Detalhes da Solicita√ß√£o #{{ solicitacao.id }}</h2>

<!-- Bot√£o de c√≥pia para WhatsApp -->
<button onclick="copiarWhatsApp()">üìã Copiar para WhatsApp</button>
<br><br>

<!-- Texto oculto formatado para WhatsApp -->
<textarea id="textoWhatsapp" style="display: none;">
*Solicita√ß√£o de Compra*

*Empresa:* {{ solicitacao.empresa_solicitante.nome if solicitacao.empresa_solicitante else '---' }}
*Unidade:* {{ solicitacao.unidade.nome if solicitacao.unidade else '---' }}
*Solicitante:* {{ solicitacao.usuario.nome }}
*Finalidade:* {{ solicitacao.finalidade }}
*Tipo de Recebimento:* {{ solicitacao.tipo_recebimento }}
{% if solicitacao.tipo_recebimento == 'RETIRADA' %}
*Retirada por:* {{ solicitacao.nome_retirada }}
{% endif %}

*Itens Solicitados:*
{% for item in itens %}- {{ item.quantidade }}x {{ item.nome_produto.split(' ')[0] }}
{% endfor %}
</textarea>

<ul>
    <li><strong>Empresa:</strong> {{ solicitacao.empresa_solicitante.nome if solicitacao.empresa_solicitante else '---'
        }}</li>
    <li><strong>Unidade:</strong> {{ solicitacao.unidade.nome if solicitacao.unidade else '---' }}</li>
    <li><strong>Solicitante:</strong> {{ solicitacao.usuario.nome }}</li>
    <li><strong>Finalidade:</strong> {{ solicitacao.finalidade }}</li>
    <li><strong>Centro de Custo:</strong> {{ solicitacao.centro_custo or '---' }}</li>
    <li><strong>Tipo de Recebimento:</strong> {{ solicitacao.tipo_recebimento }}</li>
    <li><strong>Status:</strong> {{ solicitacao.status }}</li>
    <li><strong>Prazo Limite:</strong> {{ solicitacao.prazo_limite.strftime('%d/%m/%Y') if solicitacao.prazo_limite else
        '---' }}</li>
</ul>

<h3>Itens Solicitados</h3>
<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>Produto</th>
            <th>T√©cnico</th>
            <th>Qtd</th>
            <th>Voltagem</th>
            <th>Especifica√ß√µes</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody>
        {% for item in itens %}
        <tr>
            <td>{{ item.nome_produto }}</td>
            <td>{{ item.nome_tecnico }}</td>
            <td>{{ item.quantidade }}</td>
            <td>{{ item.voltagem }}</td>
            <td>{{ item.especificacoes }}</td>
            <td>{% if item.link %}<a href="{{ item.link }}" target="_blank">Link</a>{% endif %}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Aprovar ou Rejeitar</h3>
<form method="POST" action="{{ url_for('aprovacoes.aprovar_solicitacao', id=solicitacao.id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" style="background-color: #4CAF50; color: white; padding: 8px 16px;">Aprovar</button>
</form>
<br>
<form method="POST" action="{{ url_for('aprovacoes.rejeitar_solicitacao', id=solicitacao.id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <label>Motivo da Rejei√ß√£o:</label><br>
    <textarea name="motivo" rows="3" cols="50" placeholder="Descreva aqui o motivo se for rejeitar..."></textarea><br>
    <button type="submit" style="background-color: #f44336; color: white; padding: 8px 16px;">Rejeitar</button>
</form>
<br>
<a href="{{ url_for('aprovacoes.listar_solicitacoes') }}">&larr; Voltar √† lista</a>

<script>
    function copiarWhatsApp() {
        const texto = document.getElementById("textoWhatsapp");
        texto.style.display = "block";
        texto.select();
        document.execCommand("copy");
        texto.style.display = "none";
        alert("Texto copiado para o WhatsApp!");
    }
</script>

{% endblock %}