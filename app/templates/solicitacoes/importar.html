{# templates/solicitacoes/importar.html #}
{% extends 'base.html' %}
{% block title %}Importar Solicitação via Planilha{% endblock %}

{% block content %}
<h2>Importar Solicitação via Planilha</h2>

<!-- 1) Links para baixar cada template -->
<p>
    <a href="{{ url_for('solicitacoes.download_template', tipo='retirada') }}">
        ↓ Baixar modelo Retirada (.xlsx)
    </a><br>
    <a href="{{ url_for('solicitacoes.download_template', tipo='entrega') }}">
        ↓ Baixar modelo Entrega (.xlsx)
    </a>
</p>

<hr>

<!-- 2) Exibição de mensagens de flash (sucesso ou erro) -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class="flashes">
    {% for category, message in messages %}
    <li class="flash-{{ category }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('solicitacoes.importar_solicitacao') }}" enctype="multipart/form-data">
    <label for="tipo_importacao">Tipo de Importação:</label><br>
    <input type="radio" name="tipo_importacao" value="retirada" id="tipo-retirada" checked>
    <label for="tipo-retirada">Retirada</label>
    <input type="radio" name="tipo_importacao" value="entrega" id="tipo-entrega">
    <label for="tipo-entrega">Entrega</label>
    <br><br>

    <label for="arquivo_excel">Anexar planilha (.xlsx):</label><br>
    <input type="file" name="arquivo_excel" id="arquivo_excel" accept=".xlsx" required>
    <br><br>

    <button type="submit">Importar</button>
</form>

<hr>

<!-- 3) Se houver erros, exibe relatório em tabela -->
{% if errors %}
<h3>Linhas com erro:</h3>
<table border="1" cellpadding="5" cellspacing="0">
    <thead>
        <tr>
            <th>Linha</th>
            <th>Descrição do Erro</th>
        </tr>
    </thead>
    <tbody>
        {% for err in errors %}
        <tr>
            <td>{{ err.linha }}</td>
            <td>{{ err.mensagem }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<!-- Botão para voltar à Nova Solicitação -->
<p>
    <a href="{{ url_for('solicitacoes.nova_solicitacao') }}" class="botao-secundario">
        ← Voltar para Nova Solicitação
    </a>
</p>
{% endblock %}